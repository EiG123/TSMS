CREATE TABLE pm_nodeb (
    id SERIAL PRIMARY KEY,
    site_id VARCHAR(50) NOT NULL,
    round VARCHAR(20) NULL,
    cabinet_total INTEGER NULL,
    region VARCHAR(100) NULL,
    datetime TIMESTAMP NULL,
    status VARCHAR(50) NULL,
    generator VARCHAR(50) NULL,
    transformer VARCHAR(50) NULL,
    kwh_meter VARCHAR(50) NULL,
    solar_cell VARCHAR(50) NULL,
    mowing VARCHAR(50) NULL,
    planwork VARCHAR(100) NULL,
    created_by VARCHAR(100) NULL,
    remark TEXT NULL,
    img_photo_preview VARCHAR(255) NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL
);

CREATE INDEX idx_pm_nodeb_site_id ON pm_nodeb (site_id);
CREATE INDEX idx_pm_nodeb_pm_date ON pm_nodeb (datetime);

CREATE TABLE pm_title (
    id SERIAL PRIMARY KEY,

    title VARCHAR(50),

    rank INTEGER NOT NULL,
    title_type VARCHAR(50) NULL,
    pm_mode VARCHAR(50) NULL,

    status VARCHAR(50) NOT NULL,
    reportable VARCHAR(50) NOT NULL,

    fso VARCHAR(50) NOT NULL,
)

CREATE TABLE pm_title_child (
    id SERIAL PRIMARY KEY,
    title_id INTEGER NOT NULL,
    
    title_child VARCHAR(50),
    rank INTEGER NOT NULL,
    mode VARCHAR(50),
    type VARCHAR(50),

    result VARCHAR(50),
    result_status VARCHAR(50),

    value_1 VARCHAR(50),
    value_1_status VARCHAR(50),
    value_1_input_type VARCHAR(50),
    value_2 VARCHAR(50),
    value_2_status VARCHAR(50),
    value_2_input_type VARCHAR(50),
    value_3 VARCHAR(50),
    value_3_status VARCHAR(50),
    value_3_input_type VARCHAR(50),

    remark VARCHAR(100)

    CONSTRAINT fk_pm_title_child_pm
        FOREIGN KEY (title_id)
        REFERENCES pm_title(id)
        ON DELETE CASCADE
)

CREATE TABLE pm_site_information (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_site_information_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_site_information_pm_id
ON pm_site_information(pm_id);


CREATE TABLE pm_cabinets (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_cabinets_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_cabinets_pm_id
ON pm_cabinets(pm_id);


CREATE TABLE pm_kwh_meter (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,
    cab_number INTEGER NOT NULL,
    kwh_meter_number INTEGER NOT NULL,

    phase_type VARCHAR(10) NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_kwh_meter_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE TABLE pm_kwh_meter_p1 (
    kwh_meter_id INTEGER PRIMARY KEY,

    l_input_result VARCHAR(50),
    l_input_value VARCHAR(50),
    l_input_remark TEXT,

    l_output_result VARCHAR(50),
    l_output_value VARCHAR(50),
    l_output_remark TEXT,

    n_input_result VARCHAR(50),
    n_input_value VARCHAR(50),
    n_input_remark TEXT,

    n_output_result VARCHAR(50),
    n_output_value VARCHAR(50),
    n_output_remark TEXT,

    CONSTRAINT fk_p1_meter
        FOREIGN KEY (kwh_meter_id)
        REFERENCES pm_kwh_meter(id)
        ON DELETE CASCADE
);

CREATE TABLE pm_kwh_meter_p3 (
    kwh_meter_id INTEGER PRIMARY KEY,

    r_input_result VARCHAR(50),
    r_input_value VARCHAR(50),
    r_input_remark TEXT,

    r_output_result VARCHAR(50),
    r_output_value VARCHAR(50),
    r_output_remark TEXT,

    s_input_result VARCHAR(50),
    s_input_value VARCHAR(50),
    s_input_remark TEXT,

    s_output_result VARCHAR(50),
    s_output_value VARCHAR(50),
    s_output_remark TEXT,

    t_input_result VARCHAR(50),
    t_input_value VARCHAR(50),
    t_input_remark TEXT,

    t_output_result VARCHAR(50),
    t_output_value VARCHAR(50),
    t_output_remark TEXT,

    n_input_result VARCHAR(50),
    n_input_value VARCHAR(50),
    n_input_remark TEXT,

    n_output_result VARCHAR(50),
    n_output_value VARCHAR(50),
    n_output_remark TEXT,

    CONSTRAINT fk_p3_meter
        FOREIGN KEY (kwh_meter_id)
        REFERENCES pm_kwh_meter(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_kwh_meter_pm_id
ON pm_kwh_meter(pm_id);

CREATE TABLE pm_transformer (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    transformer_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    
    

    CONSTRAINT fk_pm_transformer_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_transformer_pm_id
ON pm_transformer(pm_id);

CREATE TABLE pm_generator (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    generator_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    
    

    CONSTRAINT fk_pm_generator_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_generator_pm_id
ON pm_generator(pm_id);

CREATE TABLE pm_site_facility (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    
    

    CONSTRAINT fk_pm_site_facility_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_site_facility_pm_id 
ON pm_site_facility(pm_id);

CREATE TABLE pm_voltage_input (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    
    

    CONSTRAINT fk_pm_voltage_input_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_voltage_input_pm_id 
ON pm_voltage_input(pm_id);

CREATE TABLE pm_mdb_ac (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    
    

    CONSTRAINT fk_pm_mdb_ac_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_mdb_ac_pm_id
ON pm_mdb_ac(pm_id);

CREATE TABLE pm_grounding_system (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    
    

    CONSTRAINT fk_pm_grounding_system_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_grounding_system_pm_id
ON pm_grounding_system(pm_id);

CREATE TABLE pm_external_alarm_before (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    
    

    CONSTRAINT fk_pm_external_alarm_before_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_external_alarm_before_pm_id
ON pm_external_alarm_before(pm_id);

CREATE TABLE pm_nodeb_tx_equipment (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    
    

    CONSTRAINT fk_pm_nodeb_tx_equipment_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_nodeb_tx_equipment_pm_id
ON pm_nodeb_tx_equipment(pm_id);

CREATE TABLE pm_rectifier (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,
    
    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_rectifier_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_rectifier_pm_id
ON pm_rectifier(pm_id);

CREATE TABLE pm_cabinet_check (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_cabinet_check_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_cabinet_check_pm_id
ON pm_cabinet_check(pm_id);

CREATE TABLE pm_batteries (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,
    
    battery_number VARCHAR(50) NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_batteries_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_batteries_pm_id
ON pm_batteries(pm_id);

CREATE TABLE pm_battery_backup (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_battery_backup_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_battery_backup_pm_id
ON pm_battery_backup(pm_id);

CREATE TABLE pm_test_alarm (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_test_alarm_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_test_alarm_pm_id
ON pm_test_alarm(pm_id);

CREATE TABLE pm_filter_check (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    cab_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_filter_check_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_filter_check_pm_id
ON pm_filter_check(pm_id);


CREATE TABLE pm_online_equipment (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,
    cab_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_online_equipment_pm_id
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_online_equipment_pm_id
ON pm_online_equipment(pm_id);

CREATE TABLE pm_mowing (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_mowing_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_mowing_pm_id
ON pm_mowing(pm_id);

CREATE TABLE pm_solar_cell (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    solar_cell_number INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_solar_cell_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_solar_cell_pm_id
ON pm_solar_cell(pm_id);

CREATE TABLE pm_air_maintenance (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    round_number INTEGER NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_air_maintenance_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_air_maintenance_pm_id
ON pm_air_maintenance(pm_id);

CREATE TABLE pm_nop_external_alarm_after (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    title_id VARCHAR(50),
    title_child VARCHAR(50),
    
    CONSTRAINT fk_pm_nop_external_alarm_after_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_nop_external_alarm_after_pm
ON pm_nop_external_alarm_after(pm_id);

CREATE TABLE pm_nop_verify (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,
    
    title_id VARCHAR(50),
    title_child VARCHAR(50),

    CONSTRAINT fk_pm_nop_verify_pm
        FOREIGN KEY (pm_id)
        REFERENCES pm_nodeb(id) 
        ON DELETE CASCADE
);

CREATE INDEX idx_pm_nop_verify_pm_id
ON pm_nop_verify(pm_id);

CREATE TABLE pm_images (
    id SERIAL PRIMARY KEY,
    pm_id INTEGER NOT NULL,

    category VARCHAR(50),
    field_name VARCHAR(100) NULL,   
    sub_id INTEGER NULL,           
    file_path VARCHAR(255),    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT fk_pm_images_pm
        FOREIGN KEY (pm_id) 
        REFERENCES pm_nodeb(id)
        ON DELETE CASCADE
);



//คำสั่งลบ
DROP TABLE IF EXISTS pm_site_information;
DROP TABLE IF EXISTS pm_cabinets;
DROP TABLE IF EXISTS pm_kwh_meter_p1;
DROP TABLE IF EXISTS pm_kwh_meter_p3;
DROP TABLE IF EXISTS pm_kwh_meter;
DROP TABLE IF EXISTS pm_transformer;
DROP TABLE IF EXISTS pm_generator;
DROP TABLE IF EXISTS pm_site_facility;
DROP TABLE IF EXISTS pm_voltage_input;
DROP TABLE IF EXISTS pm_mdb_ac;
DROP TABLE IF EXISTS pm_grounding_system;
DROP TABLE IF EXISTS pm_external_alarm_before;
DROP TABLE IF EXISTS pm_nodeb_tx_equipment;
DROP TABLE IF EXISTS pm_rectifier;
DROP TABLE IF EXISTS pm_cabinet_check;
DROP TABLE IF EXISTS pm_batteries;
DROP TABLE IF EXISTS pm_battery_backup;
DROP TABLE IF EXISTS pm_test_alarm;
DROP TABLE IF EXISTS pm_filter_check;
DROP TABLE IF EXISTS pm_online_equipment;
DROP TABLE IF EXISTS pm_mowing;
DROP TABLE IF EXISTS pm_solar_cell;
DROP TABLE IF EXISTS pm_air_maintenance;
DROP TABLE IF EXISTS pm_nop_external_alarm_after;
DROP TABLE IF EXISTS pm_nop_verify;
DROP TABLE IF EXISTS pm_images;
DROP TABLE IF EXISTS pm_nodeb;